<!DOCTYPE html>
<html ng-app="harvesterApp">
    <head>
        <title>Harvester</title>
        <meta charset="UTF-8">
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>      
        <link rel="icon" href="harvester.ico" />
        <script src="js/angular.min.js"></script>
        <script src="js/ng-websocket.js"></script>
        <script type="text/javascript">
            var harvesterApp = angular.module('harvesterApp', ['ngWebsocket'])
                    .run(function ($websocket) {
                        var ws = $websocket.$new('ws://' + document.location.host + '/harvester/logs');
                        ws.$on('$message', function (data) {
                            console.log(data);
                        });
                    });
            
            harvesterApp.controller('HarvesterCtrl', ['$scope', '$http',
                function ($scope, $http) {
                    $http.get('service/directory').success(function (data) {
                        $scope.info = data;
                    });

                    $scope.setLogs = function (data) {
                        [].push.apply($scope.logs, data);
                    };
                }]);
        </script>
        <!--
        <script type="text/javascript">
            function info() {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {

                        var info = eval("(" + xmlHttp.responseText + ")");

                        var i = document.getElementById("info");
                        i.innerHTML += 'Name: ' + info.name;
                    }
                };
                xmlHttp.open("GET", 'service/directory', true);
                xmlHttp.send(null);
            }
            window.addEventListener("load", info, false);
        -->
        <!--
        <script type="text/javascript">
            var wsocket;
            function connect() {
                wsocket = new WebSocket('ws://' + document.location.host + '/harvester/logs');
                wsocket.onmessage = onMessage;
            }
            function onMessage(evt) {
//                document.getElementById("logs").innerHTML += '<div class="alert alert-info">' + evt.data + '</div>';
                document.getElementById("logs").insertAdjacentHTML('afterbegin', '<div class="alert alert-info">' + evt.data + '</div>');

                document.getElementById("progress-bar").style.width = 50 + '%';
            }
            window.addEventListener("load", connect, false);
        </script>     
        -->
    </head>
    <body ng-controller="HarvesterCtrl">
        <div class="container">
            <div class="row">
                <h1 class="page-header">Configuration</h1>
                <div class="col-md-8">
                    <ul class="list-group">
                        <li class="list-group-item">{{info.name}}</li>
                        <li class="list-group-item">Dapibus ac facilisis in</li>
                        <li class="list-group-item">Morbi leo risus</li>
                        <li class="list-group-item">Porta ac consectetur ac</li>
                        <li class="list-group-item">Vestibulum at eros</li>
                    </ul>                    
                </div>
                <div class="col-md-4">
                    <a class="btn btn-success" href="service/directory/*/insert">Import all data</a>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="progress">
                            <div id="progress-bar" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                <span class="sr-only"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                    </div>
                </div>

                <h1 class="page-header">Logs</h1>                

                <ul>
                    <li ng-repeat="log in logs">
                        {{log.data}}
                    </li>
                </ul>
            </div>
        </div>
    </body>
</html>
